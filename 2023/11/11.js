// @ts-check
"use strict";
import {transpose, insert, range, getCombinations, reduceSum, insertValueAtMutating} from "../../helpmodule.js";


/**
 * 
 * @param {string[][]} array 
 * @param {number} column 
 * @returns {string[][]}
 */
const insertColumn = (array, column) => {
    return transpose(
        insert(
            transpose(array.slice().map(row => row.slice())),
            column,
            range(0, array[0].length).map(e => "x")))
}

/**
 * 
 * @param {*} array 
 * @param {*} row 
 * @returns {string[][]}
 */
const insertRowB = (array, row) =>
    insertValueAtMutating(
        array,
        row,
        range(0, array[0].length).map(e => "x"))
/**
 * 
 * @param {*} array 
 * @param {number} col
 * @returns {string[][]}
 */

const insertColumnB = (array, col) =>
    transpose(insertValueAtMutating(
        transpose(array.slice().map(line => line.slice())),
        col,
        range(0, array[0].length - 1).map(e => "X")))

/**
 * 
 * @param {string[][]} array 
 * @param {number} row 
 * @returns {string[][]}
 */
const insertRow = (array, row) => {
    return insert(
        array.slice().map(row => row.slice()),
        row,
        range(0, array[0].length - 1).map(e => "X"))
}
/**
 * @typedef {{x:number,y:number}} Point
 */




const array = getInput()
    .split("\n")
    .map(line =>
        line.split(""))

/**
 * 
 * @param {*} array 
 * @returns {number[]}
 */
const getRowsWithOutStar = (array) =>
    array
        .map((row, i) => row.join("").indexOf("#") === -1 ? i : 0)
        .filter(num => !!num)
        .sort((a, b) => b - a)

const rowsWithoutStar = getRowsWithOutStar(array);
const columnsWithoutStar =
    getRowsWithOutStar(transpose(array))

/** 
 * @type {string[][]}
*/
let arrayMutating = array.map(line => line.slice()).slice()
columnsWithoutStar
    .forEach(colNum => {
        //        for (let i = 0; i < 9; i++) {
        //           i % 100000 === 0 ? console.log("insertColumn", i) : false;
        arrayMutating = insertColumnB(arrayMutating, colNum)
        //     }
    })
rowsWithoutStar
    .forEach(rowNum => {
        //    for (let i = 0; i < 9; i++) {
        //       i % 100000 === 0 ? console.log("insertRow", i) : false;
        arrayMutating = insertRowB(arrayMutating, rowNum)
        //   }
    })

//console.log(arrayMutating.map(line => line.join(" ")).join("\n"))
/**
 * 
 * @param {Point} point1 
 * @param {Point} point2 
 */
const getDistance = (point1, point2) =>
    Math.max(point1.x, point2.x) - Math.min(point1.x, point2.x) +
    (Math.max(point1.y, point2.y) - Math.min(point1.y, point2.y))


/**
 * 
 * @param {Point} point1 
 * @param {Point} point2 
 */
const getDistanceForB = (point1, point2) => {
    const crossingRowsAmount =
        rowsWithoutStar
            .filter(row =>
                Math.min(point1.y, point2.y) < row && Math.max(point1.y, point2.y) > row)
    //            .length;
    const crossingColumnsAmount =
        columnsWithoutStar
            .filter(col =>
                Math.min(point1.x, point2.x) < col && Math.max(point1.x, point2.x) > col)
    //          .length;

    //   console.log({point1, point2, crossingColumnsAmount, crossingRowsAmount})
    return (Math.max(point1.x, point2.x) - Math.min(point1.x, point2.x) +
        (Math.max(point1.y, point2.y) - Math.min(point1.y, point2.y))) +
        999999 * (crossingRowsAmount.length + crossingColumnsAmount.length)

}



const starPositions =
    arrayMutating
        .flatMap((line, y) => line.map((char, x) => char === "#" ? {x: x, y: y} : null).filter(e => e))

console.log("A::\n",
    arrayMutating, "\n" +
getCombinations(starPositions, 2)
    .map(
        /**
         * 
         * @param {[Point,Point]} pair 
         * @returns 
         */
        pair => getDistance(...pair))
    .reduce(reduceSum)
    // .map(line => line.join(" ")).join("\n")

)

console.log('B:\n',
    arrayMutating, "\n" +
getCombinations(starPositions, 2)
    .map(
        /**
         * 
         * @param {[Point,Point]} pair 
         * @returns 
         */
        pair => getDistanceForB(...pair))
    .reduce(reduceSum)
    // .map(line => line.join(" ")).join("\n")
)


/**
 * @returns {string}
 */

function getTestInput() {
    return (
        `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`);
}
/**
 * 
 * @returns {string}
 */
function getInput() {
    return (
        `..............................#.........................#.......................#..............................#.........................#..
....#.....#...................................#.............................................................................................
.....................................#..................................#...................................................................
...................................................#....................................................................#...................
...............................................................#..................#...............................#.........................
...............#.......................................#...................................#.....#.......#.........................#........
............................................................................................................................................
............................................................................#...............................................................
.......#.......................#....................#.......................................................................................
........................#..................#....................................................................#...........................
..#.......................................................#.........#....................#....................................#.............
..............#...........................................................#..........................................................#......
......................................#...........................................#..........................#..............................
.....................................................#.........#..........................................................................#.
#.......#....................................#.................................................#............................................
..............................#.......................................#..............#....................#..........#......................
....#...................................#...................................................................................................
....................................................................................................#.......................................
.....................#...........#...............................................#..................................................#.......
...............................................#.........#..................................................#..................#............
..........................................................................#...............#........................#........................
.................#.......................................................................................................#..................
......................................................................................#..................#..............................#...
.............#...................................................................................#..........................................
#...........................#..........#....................................................................................................
.........#........................................................................#...............................#.........................
.....................#.........................#.....................................................#....................#......#..........
.....................................................................#......................................................................
................................#.....................................................................................................#.....
...............#..........................................#.................#................#..............................................
....................................#...........................#...........................................#...............................
.......#...................#................#.......................................#..............................#......................#.
......................#.................................................#................................................#..................
....................................................#......................................#............#...................................
.............#........................#..........................................................#.............#............................
...................#..............................................................#.........................................................
.........................................................#..................#..........#....................................................
........................#.....................#..............................................#.........................................#....
.................................................................#.........................................#...................#............
...................................................#........#.....................................#......................#..................
.........#....................#.......#................................................................#............#.......................
#.............................................................................#.....................................................#.......
..................#.......#.................................................................................................................
.............#........................................................#........................#................#..........#..............#.
.....................................................#......................................................................................
.......#...............#.................#......................#................#..........................................................
...................................#.....................................................#............................#.....................
............................................................................................................................................
...............................#........................................#.........................#.........................................
.....#.........#...............................#...................#.....................................................................#..
............................................................................................................................................
..........#......................................................................#..........................................................
.........................................#.............................................#......#...................#...................#.....
........................#.....#........................................................................#....................................
...................................................#.....#...................#..............................................................
....................................................................#...............#....................................#........#.........
...........................#..............................................................#.................................................
...#........................................#.........#.......................................................#..............#..............
..........#....................................................#................#...........................................................
..................................#..................................................................................#...............#......
.................#..........................................................................................................................
............................................................................................................................................
............................#.............#................................#.........................#.....................#................
.........#.........................................#............#.........................#............................................#....
....#................................................................#.........................#..............#.............................
...................#......................................#.................................................................................
..............................#......#..............................................#..............#................#.......................
.............................................................................#..............................................................
.......#.........................................................................................................................#..........
..............#............#....................#...................#............#.......#.................................#................
................................#......................#................................................#.................................#.
............................................................................................................................................
.#......................#......................................#...............................................#............................
........................................................................#............................#......................................
..................................................#..........................#..........................................#.......#...........
.........................................#..........................................#....................#..............................#...
......#...............#.................................#...................................................................................
....................................#.......................................................................................................
...............................................................#................#........#.........................#..........#.............
..#........#.....#..........#...................#...................................................#.......................................
.......................................#...........................#...........................................#............................
.............................................................................#..............................................................
.......................#..................................#............#...............#.......#.....................................#......
............................................................................................................................................
............#.....#................................#...........#...................................................#............#...........
...........................................#..............................................#.................................................
..................................#..............................................#.....................#....................................
..................................................................#.........................................................................
...#..........................#............................................#................................................................
.......................................................#..........................................#........#........#.......................
.......................................#.................................................................................#......#...........
.................................................#..........#.........#.......................#.............................................
............................................................................................................................................
....#...........#........................................................................................#.......#...........#..............
......................#...........#.......#....................#..............#.....#.......................................................
.........#...............................................................................#..................................................
..................................................#.........................................................................................
...................#......................................#...........................................#...........................#......#..
.............#..........#.....................#....................#........................................................................
...............................................................................#.....#.....#.................#......#.......................
...#.........................#...................................................................#........................#.................
............................................................................................................................................
.......#.........#..........................................#...............................................................................
.................................#..............................................................................................#...........
........................................................................#..............#.......#..................#........................#
.#...................................#......#......#........................................................................................
............................................................................................................................................
.............#................#............................................................#..............#.................................
......#.....................................................#.......................#................#...............................#......
...................#..............................................#.......................................................#.................
....................................#.....................................#.................................................................
........................................................................................................#.......#...........................
....#.....................................#...............#...................#...............#.........................................#...
.....................................................................................#......................................................
....................................................#...........#......................................................#............#.......
........................#...................................................................................#...............................
............................................................................#.....#.........#......................#........................
...#.....#.....#.......................#....................................................................................................
............................................................................................................................................
......................................................................#.....................................................................
......................................................................................#............#..........................#.............
.....#.............#.........................................................#................#.............................................
..............................#..........#............#.....#...........................................................#.............#.....
........................................................................#................#..................................................
..................................................................................#.........................................................
......................#.............#....................#........................................................#.........................
.................#................................#.............#.............#.............................................................
............................................................................................................................................
...#..........................#.............#....................................................#.......#...............#.........#........
........#...........#.................#..................................................................................................#..
..............#.................................#.....#..........................................................#..........................
...........................................................#......#.........................................................................
............................#..................................................#.....................................#......................
...................................................#.......................................#................................................
.#................#................#...............................................#...........................................#.....#......
.............#....................................................................................................#.........................
.........................#...........................................#.....#......................#..........#..............................
........................................#...................#...........................................#...................................
...#......#............................................................................#....................................................
...............................................#.......................................................................#....................`);
}

